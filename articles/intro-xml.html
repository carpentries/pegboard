<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Working with XML data • pegboard</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Working with XML data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pegboard</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.7.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/intro-xml.html">Working with XML data</a></li>
    <li><a class="dropdown-item" href="../articles/intro-episode.html">Introduction to the Episode Object</a></li>
    <li><a class="dropdown-item" href="../articles/intro-lesson.html">Introduction to the Lesson Object</a></li>
    <li><a class="dropdown-item" href="../articles/validation.html">Validation of Lesson Elements</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/carpentries/pegboard/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Working with XML data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/carpentries/pegboard/blob/0.7.7/vignettes/intro-xml.Rmd" class="external-link"><code>vignettes/intro-xml.Rmd</code></a></small>
      <div class="d-none name"><code>intro-xml.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>You will want to read this vignette if you are interested in
contributing to {pegboard}, or if you would like to understand how to
fine-tune the transition of a lesson from the styles infrastructure to
The Workbench (see <a href="https://github.com/carpentries/lesson-transition#readme" class="external-link uri">https://github.com/carpentries/lesson-transition#readme</a>),
or if you want to know how to better inspect the output of some of
{pegboard}’s accessors. In this vignette, I assume that you are familiar
with writing R functions and that R will default to passing an object’s
<em>value</em> to a function and not a <em>reference</em> (though if you
do not understand that last part, do not worry, I will try to dispell
this).</p>
<p>The {pegboard} package is an enhancement of the {tinkr} package,
which transforms Markdown to XML and back again. <a href="https://www.geeksforgeeks.org/html-vs-xml/" class="external-link">XML is a markup
language that is derived from HTML</a> designed to handle structured
data. A more modern format for storing and transporting data on the web
is JSON, but the advantage of using XML is that we are able to use the
<a href="https://en.wikipedia.org/wiki/XPath" class="external-link">XPath</a> language to
parse it (more on that later). Moreover, because XML has the same
structure as HTML, it can be parsed using the same tools, which is
advantageous for a suite of packages that transforms Markdown to HTML.
This transformation is facilitated by the <a href="https://docs.ropensci.org/commonmark/" class="external-link">{commonmark}</a> for
transforming Markdown to XML and <a href="https://docs.ropensci.org/xslt/" class="external-link">{xslt}</a> for transforming XML
to Markdown.</p>
</div>
<div class="section level2">
<h2 id="motivating-example">Motivating Example<a class="anchor" aria-label="anchor" href="#motivating-example"></a>
</h2>
<p>During the lesson transition, I was often faced with situations that
required me to perform intricate replacements in documents while
preserving the structure. One such example is transitioning the
“workshop” or “overview” lessons that did not have any episodes and
relied on separate child documents to separate out redundant elements.
Let’s say we had a file called <code>setup.md</code> and two other files
called <code>setup-python.md</code> and <code>setup-r.md</code> that
look like this:</p>
<p><code>setup.md</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">## Setup Instructions</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">### Python</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>{% include setup-python.md%}</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">### R</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>{% include setup-r.md %}</span></code></pre></div>
<p><code>setup-python.md</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>Install _python_ from **anaconda**</span></code></pre></div>
<p><code>setup-r.md</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>Install _R_ from **CRAN**</span></code></pre></div>
<p>The output of <code>setup.md</code> when its rendered would include
the text from both <code>setup-python.md</code> and
<code>setup-r.md</code>, but the thing is, the
<code>{% include %}</code> tags are a syntax that is specific to Jekyll.
Instead, for The Workbench, we wanted to use the <a href="https://bookdown.org/yihui/rmarkdown-cookbook/child-document.html" class="external-link">R
Markdown child document declaration</a>, so that <code>setup.md</code>
would look like this:</p>
<p><code>setup.md</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>## Setup Instructions</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>### Python</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>```{r child="files/setup-python.md"}</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>```</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>### R</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>```{r child="files/setup-r.md"}</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>```</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">setup_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext<span class="op">=</span><span class="st">".md"</span><span class="op">)</span></span>
<span><span class="va">stp</span> <span class="op">&lt;-</span> <span class="st">"## Setup Instructions</span></span>
<span><span class="st"></span></span>
<span><span class="st">### Python</span></span>
<span><span class="st"></span></span>
<span><span class="st">{% include setup-python.md%}</span></span>
<span><span class="st"></span></span>
<span><span class="st">### R</span></span>
<span><span class="st"></span></span>
<span><span class="st">{% include setup-r.md %}</span></span>
<span><span class="st">"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">stp</span>, <span class="va">setup_file</span><span class="op">)</span></span></code></pre></div>
<p>By using the following function (originally in <a href="https://github.com/carpentries/lesson-transition/blob/f8edb10b2e13a926e3df9ba522983f930d0ee19b/datacarpentry/ecology-workshop.R#L23-L44" class="external-link">lesson-transition/datacarpentry/ecology-workshop.R</a>),
it was possible:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">child_from_include</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">from</span>, <span class="va">to</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">to</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">to</span><span class="op">)</span><span class="op">)</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_file.html" class="external-link">path_ext_set</a></span><span class="op">(</span><span class="va">from</span>, <span class="st">"Rmd"</span><span class="op">)</span> <span class="kw">else</span> <span class="va">to</span></span>
<span>  <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/abort.html" class="external-link">inform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>i <span class="op">=</span> <span class="va">from</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">ep</span> <span class="op">&lt;-</span> <span class="fu">pegboard</span><span class="fu">::</span><span class="va"><a href="../reference/Episode.html">Episode</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">from</span><span class="op">)</span></span>
<span>  <span class="co"># find all the {% include file.ext %} statements</span></span>
<span>  <span class="va">includes</span> <span class="op">&lt;-</span> <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_all</a></span><span class="op">(</span><span class="va">ep</span><span class="op">$</span><span class="va">body</span>, </span>
<span>    <span class="st">".//md:text[starts-with(text(), '{% include')]"</span>, ns <span class="op">=</span> <span class="va">ep</span><span class="op">$</span><span class="va">ns</span><span class="op">)</span></span>
<span>  <span class="co"># trim off everything but our precious file path</span></span>
<span>  <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"[%{ }]|include"</span>, <span class="st">""</span>, <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_text.html" class="external-link">xml_text</a></span><span class="op">(</span><span class="va">includes</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># give it a name </span></span>
<span>  <span class="va">fname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"include-"</span>, <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_file.html" class="external-link">path_ext_remove</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># make sure the file path is correct</span></span>
<span>  <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sQuote.html" class="external-link">sQuote</a></span><span class="op">(</span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="st">"files"</span>, <span class="va">f</span><span class="op">)</span>, q <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html" class="external-link">xml_parent</a></span><span class="op">(</span><span class="va">includes</span><span class="op">)</span></span>
<span>  <span class="co"># remove text node</span></span>
<span>  <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_replace.html" class="external-link">xml_remove</a></span><span class="op">(</span><span class="va">includes</span><span class="op">)</span></span>
<span>  <span class="co"># change paragraph node to a code block and add chunk attributes</span></span>
<span>  <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_name.html" class="external-link">xml_set_name</a></span><span class="op">(</span><span class="va">p</span>, <span class="st">"code_block"</span><span class="op">)</span></span>
<span>  <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_attr.html" class="external-link">xml_set_attr</a></span><span class="op">(</span><span class="va">p</span>, <span class="st">"language"</span>, <span class="st">"r"</span><span class="op">)</span></span>
<span>  <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_attr.html" class="external-link">xml_set_attr</a></span><span class="op">(</span><span class="va">p</span>, <span class="st">"child"</span>, <span class="va">f</span><span class="op">)</span></span>
<span>  <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_attr.html" class="external-link">xml_set_attr</a></span><span class="op">(</span><span class="va">p</span>, <span class="st">"name"</span>, <span class="va">fname</span><span class="op">)</span></span>
<span>  <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_move.html" class="external-link">file_move</a></span><span class="op">(</span><span class="va">from</span>, <span class="va">to</span><span class="op">)</span></span>
<span>  <span class="va">ep</span><span class="op">$</span><span class="fu">write</span><span class="op">(</span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_file.html" class="external-link">path_dir</a></span><span class="op">(</span><span class="va">to</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"Rmd"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">setup_file</span><span class="op">)</span><span class="op">)</span> <span class="co"># show the file </span></span>
<span><span class="co">#&gt; ## Setup Instructions</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Python</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; {% include setup-python.md%}</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### R</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; {% include setup-r.md %}</span></span>
<span><span class="fu">child_from_include</span><span class="op">(</span><span class="va">setup_file</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> /tmp/RtmpxjjNt7/file1bb3fa2b0af.md</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_file.html" class="external-link">path_ext_set</a></span><span class="op">(</span><span class="va">setup_file</span>, <span class="st">"Rmd"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># show the file </span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; ## Setup Instructions</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Python</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ```{r include-setup-python, child='files/setup-python.md'}</span></span>
<span><span class="co">#&gt; ```</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### R</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ```{r include-setup-r, child='files/setup-r.md'}</span></span>
<span><span class="co">#&gt; ```</span></span></code></pre>
<p>This is only a small peek of what is possible with XML data and if
you are familiar with R, some of this may seem like strange syntax. If
you would like to understand a bit more, read on.</p>
</div>
<div class="section level2">
<h2 id="working-with-xml-data">Working with XML data<a class="anchor" aria-label="anchor" href="#working-with-xml-data"></a>
</h2>
<p>Each <code>Episode</code> object contains a field (you can think of
each field as a list element) called <code>$body</code>, which contains
an {xml2} document. This is the core of the <code>Episode</code> object
and every function works in some way with this field.</p>
<div class="section level3">
<h3 id="the-memory-of-xml-objects">The memory of XML objects<a class="anchor" aria-label="anchor" href="#the-memory-of-xml-objects"></a>
</h3>
<p>For the casual R user (and even for the more experienced), the way
you use this package may seem a little strange. This is because in R,
functions will not have side effects, but the vast majority of methods
in the <code>Episode</code> object will modify the object itself and
this all has to do with the way XML data is handled in R by the {xml2}
package.</p>
<p>Normally in R, when you pass data to a function, it will make a copy
of the data and then apply the function to the copy of the data:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># insert 99 after the fourth position in a vector</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">99</span>, after <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1]  1  2  3  4 99  5  6  7  8  9 10</span></span>
<span><span class="co"># note that x is not modified</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span></span></code></pre></div>
<p>When working with XML in R, the {xml2} package is unparalleled, but
it leads to surprising outcomes because when you modify content within
an XML object, you are modifying the object in place:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html" class="external-link">read_xml</a></span><span class="op">(</span><span class="st">"&lt;a&gt;&lt;b&gt;&lt;/b&gt;&lt;/a&gt;"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_document}</span></span>
<span><span class="co">#&gt; &lt;a&gt;</span></span>
<span><span class="co">#&gt; [1] &lt;b/&gt;</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">new</span> <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_replace.html" class="external-link">xml_add_child</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">new</span>, .where <span class="op">=</span> <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html" class="external-link">xml_length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">f</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co"># note that x and y are identical</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_document}</span></span>
<span><span class="co">#&gt; &lt;a&gt;</span></span>
<span><span class="co">#&gt; [1] &lt;b/&gt;</span></span>
<span><span class="co">#&gt; [2] &lt;c/&gt;</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_document}</span></span>
<span><span class="co">#&gt; &lt;a&gt;</span></span>
<span><span class="co">#&gt; [1] &lt;b/&gt;</span></span>
<span><span class="co">#&gt; [2] &lt;c/&gt;</span></span></code></pre></div>
<p>It gets a bit stranger when you consider that in the above code,
<code>y</code> and <code>x</code> are <em>exactly the same object</em>
as shown with the fact that if I manipulate <code>y</code>, then
<code>x</code> will also be modified:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">f</span><span class="op">(</span><span class="va">y</span>, <span class="st">"d"</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_document}</span></span>
<span><span class="co">#&gt; &lt;a&gt;</span></span>
<span><span class="co">#&gt; [1] &lt;b/&gt;</span></span>
<span><span class="co">#&gt; [2] &lt;c/&gt;</span></span>
<span><span class="co">#&gt; [3] &lt;d/&gt;</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_document}</span></span>
<span><span class="co">#&gt; &lt;a&gt;</span></span>
<span><span class="co">#&gt; [1] &lt;b/&gt;</span></span>
<span><span class="co">#&gt; [2] &lt;c/&gt;</span></span>
<span><span class="co">#&gt; [3] &lt;d/&gt;</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_document}</span></span>
<span><span class="co">#&gt; &lt;a&gt;</span></span>
<span><span class="co">#&gt; [1] &lt;b/&gt;</span></span>
<span><span class="co">#&gt; [2] &lt;c/&gt;</span></span>
<span><span class="co">#&gt; [3] &lt;d/&gt;</span></span></code></pre></div>
<p>I can even extract child elements from the XML document and
manipulate <em>those</em> and have them be reflected in the parent. For
example, if I extract the second child of the document, and then apply
the <code>cool="verified"</code> attribute to the child, it will be
reflected in the parent document.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">child</span> <span class="op">&lt;-</span> <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_children.html" class="external-link">xml_child</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_attr.html" class="external-link">xml_set_attr</a></span><span class="op">(</span><span class="va">child</span>, <span class="st">"cool"</span>, <span class="st">"verified"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">child</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_node}</span></span>
<span><span class="co">#&gt; &lt;c cool="verified"&gt;</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_document}</span></span>
<span><span class="co">#&gt; &lt;a&gt;</span></span>
<span><span class="co">#&gt; [1] &lt;b/&gt;</span></span>
<span><span class="co">#&gt; [2] &lt;c cool="verified"/&gt;</span></span>
<span><span class="co">#&gt; [3] &lt;d/&gt;</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_document}</span></span>
<span><span class="co">#&gt; &lt;a&gt;</span></span>
<span><span class="co">#&gt; [1] &lt;b/&gt;</span></span>
<span><span class="co">#&gt; [2] &lt;c cool="verified"/&gt;</span></span>
<span><span class="co">#&gt; [3] &lt;d/&gt;</span></span></code></pre></div>
<p>This persistance lends itself very well to using the {R6} package for
creating objects that work in a more object-oriented way (where methods
belong to classes instead of the other way around). If you are familiar
with how Python methods work, then you will be mostly familiar with how
the {R6} objects behave. It is worthwhile to read the <a href="https://r6.r-lib.org/articles/Introduction.html" class="external-link">{R6} introduction
vignette</a> if you want to understand how to program and modify this
package.</p>
<p>In the example above, you notice that I use
<code><a href="http://xml2.r-lib.org/reference/xml_children.html" class="external-link">xml2::xml_child()</a></code> to extract child nodes, but the real
power of XML comes with searching for items using XPath syntax for
traversing the XML nodes where I would be able to do one of the
following to get the child called “c”</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_first</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">".//c"</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_node}</span></span>
<span><span class="co">#&gt; &lt;c cool="verified"&gt;</span></span>
<span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_first</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"/a/c"</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_node}</span></span>
<span><span class="co">#&gt; &lt;c cool="verified"&gt;</span></span></code></pre></div>
<p>The next section will cover a bit of XPath and provide some resources
on how to practice and learn because this comes in very handy to quickly
traverse the XML nodes without relying on loops.</p>
</div>
</div>
<div class="section level2">
<h2 id="using-xpath-to-parse-xml">Using XPath to parse XML<a class="anchor" aria-label="anchor" href="#using-xpath-to-parse-xml"></a>
</h2>
<div class="section level3">
<h3 id="the-structure-of-xpath">The structure of XPath<a class="anchor" aria-label="anchor" href="#the-structure-of-xpath"></a>
</h3>
<p>In the section, we will talk about <a href="https://en.wikipedia.org/wiki/XPath#Syntax_and_semantics_(XPath_1.0)" class="external-link">XPath
syntax</a>, but it will be non-exhaustive. Unfortunately, good tutorials
on the web are few and far between, but here are some that can help:</p>
<ul>
<li>The <a href="https://developer.mozilla.org/en-US/docs/Web/XPath" class="external-link">MDN
documentation</a> is <em>usually</em> pretty good, but instead, it’s
better as a reference
<ul>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/XPath/Axes" class="external-link">MDN XPath
Axes</a> good for knowing how to navigate among nodes</li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/XPath/Functions" class="external-link">MDN
XPath functions</a> good for knowing how to filter node matches</li>
</ul>
</li>
<li>The <a href="https://www.w3schools.com/xml/xpath_intro.asp" class="external-link">w3schools tutorial
on XPath</a> is actually one of the best out there, but this is an
excpetion to the rule. Other than this tutorial, I would not trust any
content from w3schools (they are not aligned at all with the web
consortium).</li>
<li>An <a href="https://extendsclass.com/xpath-tester.html" class="external-link">XPath
tester</a> like a regex tester to allow you to try out complex queries
in a visual manner.</li>
</ul>
<p>It’s important to remember that an XML document is a tree-like
structure that is similar to directories or folders on your computer.
For example, if you look at the source directory structure of this
package, you would see a folder called <code>R/</code> and a nested
folder called <code>tests/testhat/</code>. If you started from the root
directory of this package, you would list the R files in the
<code>R/</code> folder with <code>ls R/*.R</code> similarly, if you
wanted to list the R files in the <code>tests/testthat/</code> folder,
you would us <code>ls tests/testthat/*.R</code>. In this respect, XPath
has a very similar syntax: to enter the next level of nesting, you add a
slash (<code>/</code>). For example, let’s take a look a what the file
structure would look like in XML form:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>&lt;<span class="kw">ROOT</span>&gt;</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  &lt;<span class="kw">R</span>&gt;</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>    &lt;<span class="kw">file</span><span class="ot"> ext=</span><span class="st">"R"</span>&gt;one&lt;/<span class="kw">file</span>&gt;</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>    &lt;<span class="kw">file</span><span class="ot"> ext=</span><span class="st">"R"</span>&gt;two&lt;/<span class="kw">file</span>&gt;</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>  &lt;/<span class="kw">R</span>&gt;</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>  &lt;<span class="kw">tests</span>&gt;</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>    &lt;<span class="kw">testthat</span>&gt;</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>      &lt;<span class="kw">data</span>&gt;</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>        &lt;<span class="kw">file</span><span class="ot"> ext=</span><span class="st">"txt"</span>&gt;test-data&lt;/<span class="kw">file</span>&gt;</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>      &lt;/<span class="kw">data</span>&gt;</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>      &lt;<span class="kw">file</span><span class="ot"> ext=</span><span class="st">"R"</span>&gt;test-one&lt;/<span class="kw">file</span>&gt;</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>      &lt;<span class="kw">file</span><span class="ot"> ext=</span><span class="st">"R"</span>&gt;test-two&lt;/<span class="kw">file</span>&gt;</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>    &lt;/<span class="kw">testthat</span>&gt;</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>  &lt;/<span class="kw">tests</span>&gt;</span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>&lt;/<span class="kw">ROOT</span>&gt;</span></code></pre></div>
<p>The XPath syntax to find all files in the the R and testthat folders
would be the same if you started from the root: <code>R/file</code> and
<code>tests/testthat/file</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_all</a></span><span class="op">(</span><span class="va">xml</span>, <span class="st">"R/file"</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_nodeset (2)}</span></span>
<span><span class="co">#&gt; [1] &lt;file ext="R"&gt;one&lt;/file&gt;</span></span>
<span><span class="co">#&gt; [2] &lt;file ext="R"&gt;two&lt;/file&gt;</span></span>
<span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_all</a></span><span class="op">(</span><span class="va">xml</span>, <span class="st">"tests/testthat/file"</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_nodeset (2)}</span></span>
<span><span class="co">#&gt; [1] &lt;file ext="R"&gt;test-one&lt;/file&gt;</span></span>
<span><span class="co">#&gt; [2] &lt;file ext="R"&gt;test-two&lt;/file&gt;</span></span></code></pre></div>
<p>However, XPath has one advantage that normal command line syntax
doesn’t have: you can short-cut paths, so if we wanted to find all files
in any given folder, you can use the double slash (<code>//</code>) to
recursively search through nesting. By habit, I will normally use the
precede these slashes with a dot (<code>.</code>) so that I can be sure
to start with the node that I have in my variable:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_all</a></span><span class="op">(</span><span class="va">xml</span>, <span class="st">".//file"</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_nodeset (5)}</span></span>
<span><span class="co">#&gt; [1] &lt;file ext="R"&gt;one&lt;/file&gt;</span></span>
<span><span class="co">#&gt; [2] &lt;file ext="R"&gt;two&lt;/file&gt;</span></span>
<span><span class="co">#&gt; [3] &lt;file ext="txt"&gt;test-data&lt;/file&gt;</span></span>
<span><span class="co">#&gt; [4] &lt;file ext="R"&gt;test-one&lt;/file&gt;</span></span>
<span><span class="co">#&gt; [5] &lt;file ext="R"&gt;test-two&lt;/file&gt;</span></span></code></pre></div>
<p>Of course, this method finds <em>all</em> files, so if you wanted to
filter them, you can use the bracket notation to create filters for our
selection based on the <code>ext</code> attribute, which are prefixed by
<code>@</code>. With the bracket notation, you add brackets to a node
selection with a condition. In this case, we want to test that the
extension is ‘R’, so we would use <code>[@ext='R']</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_all</a></span><span class="op">(</span><span class="va">xml</span>, <span class="st">".//file[@ext='R']"</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_nodeset (4)}</span></span>
<span><span class="co">#&gt; [1] &lt;file ext="R"&gt;one&lt;/file&gt;</span></span>
<span><span class="co">#&gt; [2] &lt;file ext="R"&gt;two&lt;/file&gt;</span></span>
<span><span class="co">#&gt; [3] &lt;file ext="R"&gt;test-one&lt;/file&gt;</span></span>
<span><span class="co">#&gt; [4] &lt;file ext="R"&gt;test-two&lt;/file&gt;</span></span></code></pre></div>
<p>In this scheme, I’ve put the file names as the text of the nodes, so
we can use the bracket notation again with <a href="https://developer.mozilla.org/en-US/docs/Web/XPath/Functions" class="external-link">XPath
functions</a> to filter for only files that contain “one”</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_all</a></span><span class="op">(</span><span class="va">xml</span>, <span class="st">".//file[@ext='R'][contains(text(), 'one')]"</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_nodeset (2)}</span></span>
<span><span class="co">#&gt; [1] &lt;file ext="R"&gt;one&lt;/file&gt;</span></span>
<span><span class="co">#&gt; [2] &lt;file ext="R"&gt;test-one&lt;/file&gt;</span></span></code></pre></div>
<p>If I only wanted to extract source files that contain “one”, I could
also use the <code>parent::</code> <a href="https://developer.mozilla.org/en-US/docs/Web/XPath/Axes" class="external-link">XPath
axis</a>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_all</a></span><span class="op">(</span><span class="va">xml</span>, <span class="st">".//file[@ext='R'][contains(text(), 'one')][parent::R]"</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_nodeset (1)}</span></span>
<span><span class="co">#&gt; [1] &lt;file ext="R"&gt;one&lt;/file&gt;</span></span></code></pre></div>
<p>Note that if I used a slash (<code>/</code>) instead of square
brackets for the parent, I would get the parent back:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_all</a></span><span class="op">(</span><span class="va">xml</span>, <span class="st">".//file[@ext='R'][contains(text(), 'one')]/parent::R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_nodeset (1)}</span></span>
<span><span class="co">#&gt; [1] &lt;R&gt;\n  &lt;file ext="R"&gt;one&lt;/file&gt;\n  &lt;file ext="R"&gt;two&lt;/file&gt;\n&lt;/R&gt;</span></span></code></pre></div>
<p>As you an see, many times, an XPath query can get kind of hairy,
which is why I often like to compose it into different parts during
programming with {glue}:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predicate</span> <span class="op">&lt;-</span> <span class="st">"[@ext='R'][contains(text(), 'one')]"</span></span>
<span><span class="va">XPath</span> <span class="op">&lt;-</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">".//file{predicate}/parent::R"</span><span class="op">)</span></span>
<span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_all</a></span><span class="op">(</span><span class="va">xml</span>, <span class="va">XPath</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_nodeset (1)}</span></span>
<span><span class="co">#&gt; [1] &lt;R&gt;\n  &lt;file ext="R"&gt;one&lt;/file&gt;\n  &lt;file ext="R"&gt;two&lt;/file&gt;\n&lt;/R&gt;</span></span></code></pre></div>
<p>In the next section, I will discuss how to extract and manipulate XML
that comes from Markdown with namespaces.</p>
</div>
</div>
<div class="section level2">
<h2 id="xml-data-from-markdown-using-namespaces">XML data from Markdown using namespaces<a class="anchor" aria-label="anchor" href="#xml-data-from-markdown-using-namespaces"></a>
</h2>
<p>The XML from markdown transformation is fully handled by the
{commonmark} package, which has the convenient
<code><a href="https://docs.ropensci.org/commonmark/reference/commonmark.html" class="external-link">commonmark::markdown_xml()</a></code> function. For example, this is
how how the following markdown is processed:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>This is a bunch of <span class="co">[</span><span class="ot">example markdown</span><span class="co">](https://example.com 'for example')</span> text</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="ss">- </span>this</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="ss">- </span>is</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="ss">- </span>a **list**</span></code></pre></div>
<blockquote>
<p>This is a bunch of <a href="https://example.com" title="for example" class="external-link">example markdown</a> text</p>
<ul>
<li>this</li>
<li>is</li>
<li>a <strong>list</strong>
</li>
</ul>
</blockquote>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"This is a bunch of [example markdown](https://example.com 'for example') text"</span>,</span>
<span>  <span class="st">""</span>,</span>
<span>  <span class="st">"- this"</span>,</span>
<span>  <span class="st">"- is"</span>,</span>
<span>  <span class="st">"- a **list**"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">xml_txt</span> <span class="op">&lt;-</span> <span class="fu">commonmark</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/commonmark/reference/commonmark.html" class="external-link">markdown_xml</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">md</span>, collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">xml_txt</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "character"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">xml_txt</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span>
<span><span class="co">#&gt; &lt;!DOCTYPE document SYSTEM "CommonMark.dtd"&gt;</span></span>
<span><span class="co">#&gt; &lt;document xmlns="http://commonmark.org/xml/1.0"&gt;</span></span>
<span><span class="co">#&gt;   &lt;paragraph&gt;</span></span>
<span><span class="co">#&gt;     &lt;text xml:space="preserve"&gt;This is a bunch of &lt;/text&gt;</span></span>
<span><span class="co">#&gt;     &lt;link destination="https://example.com" title="for example"&gt;</span></span>
<span><span class="co">#&gt;       &lt;text xml:space="preserve"&gt;example markdown&lt;/text&gt;</span></span>
<span><span class="co">#&gt;     &lt;/link&gt;</span></span>
<span><span class="co">#&gt;     &lt;text xml:space="preserve"&gt; text&lt;/text&gt;</span></span>
<span><span class="co">#&gt;   &lt;/paragraph&gt;</span></span>
<span><span class="co">#&gt;   &lt;list type="bullet" tight="true"&gt;</span></span>
<span><span class="co">#&gt;     &lt;item&gt;</span></span>
<span><span class="co">#&gt;       &lt;paragraph&gt;</span></span>
<span><span class="co">#&gt;         &lt;text xml:space="preserve"&gt;this&lt;/text&gt;</span></span>
<span><span class="co">#&gt;       &lt;/paragraph&gt;</span></span>
<span><span class="co">#&gt;     &lt;/item&gt;</span></span>
<span><span class="co">#&gt;     &lt;item&gt;</span></span>
<span><span class="co">#&gt;       &lt;paragraph&gt;</span></span>
<span><span class="co">#&gt;         &lt;text xml:space="preserve"&gt;is&lt;/text&gt;</span></span>
<span><span class="co">#&gt;       &lt;/paragraph&gt;</span></span>
<span><span class="co">#&gt;     &lt;/item&gt;</span></span>
<span><span class="co">#&gt;     &lt;item&gt;</span></span>
<span><span class="co">#&gt;       &lt;paragraph&gt;</span></span>
<span><span class="co">#&gt;         &lt;text xml:space="preserve"&gt;a &lt;/text&gt;</span></span>
<span><span class="co">#&gt;         &lt;strong&gt;</span></span>
<span><span class="co">#&gt;           &lt;text xml:space="preserve"&gt;list&lt;/text&gt;</span></span>
<span><span class="co">#&gt;         &lt;/strong&gt;</span></span>
<span><span class="co">#&gt;       &lt;/paragraph&gt;</span></span>
<span><span class="co">#&gt;     &lt;/item&gt;</span></span>
<span><span class="co">#&gt;   &lt;/list&gt;</span></span>
<span><span class="co">#&gt; &lt;/document&gt;</span></span></code></pre></div>
<p>You can see that it has successfully parsed the markdown into a
paragraph and a list and then the various elements within.</p>
<div class="section level3">
<h3 id="the-default-namespace">The default namespace<a class="anchor" aria-label="anchor" href="#the-default-namespace"></a>
</h3>
<p>Now here’s the catch: The commonmark markdown always starts with this
basic skeleton which has the root node of
<code>&lt;document xmlns="http://commonmark.org/xml/1.0"&gt;</code>. The
<code>xmlns</code> attribute defines the <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Namespaces_Crash_Course" class="external-link">default
XML namespace</a>:</p>
<pre><code><span><span class="co">#&gt; &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span>
<span><span class="co">#&gt; &lt;!DOCTYPE document SYSTEM "CommonMark.dtd"&gt;</span></span>
<span><span class="co">#&gt; &lt;document xmlns="http://commonmark.org/xml/1.0"&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; MARKDOWN CONTENT HERE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &lt;/document&gt;</span></span></code></pre>
<p>In many XML applications, namespaces will come with prefixes, which
are defined in the <code>xmlns</code> attribute
(e.g. <code>xmlns:svg="http://www.w3.org/2000/svg"</code>). If a node
has a namespace, it needs to be selected with the namespace prefix like
so: <code>.//svg:circle</code>. For default namespaces, the same rule
applies, but the question becomes: how do you know what the namespace
prefix is? In {xml2}, the default namespace always begins with
<code>d1</code> and increments up as new namespaces are added. You can
inspect the namespace with <code><a href="http://xml2.r-lib.org/reference/xml_ns.html" class="external-link">xml2::xml_ns()</a></code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xml</span> <span class="op">&lt;-</span> <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html" class="external-link">read_xml</a></span><span class="op">(</span><span class="va">xml_txt</span><span class="op">)</span></span>
<span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_ns.html" class="external-link">xml_ns</a></span><span class="op">(</span><span class="va">xml</span><span class="op">)</span></span>
<span><span class="co">#&gt; d1 &lt;-&gt; http://commonmark.org/xml/1.0</span></span></code></pre></div>
<p>Thus, the XPath query you would use to select a paragraph would be
<code>.//d1:paragraph</code>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># with namespace prefix</span></span>
<span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_all</a></span><span class="op">(</span><span class="va">xml</span>, <span class="st">".//d1:paragraph"</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_nodeset (4)}</span></span>
<span><span class="co">#&gt; [1] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;This is a bunch of &lt;/text&gt;\n  &lt; ...</span></span>
<span><span class="co">#&gt; [2] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;this&lt;/text&gt;\n&lt;/paragraph&gt;</span></span>
<span><span class="co">#&gt; [3] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;is&lt;/text&gt;\n&lt;/paragraph&gt;</span></span>
<span><span class="co">#&gt; [4] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;a &lt;/text&gt;\n  &lt;strong&gt;\n    &lt;tex ...</span></span></code></pre></div>
<p>Of course, having a default namespace in {xml2} has some drawbacks in
that <a href="https://community.rstudio.com/t/adding-nodes-in-xml2-how-to-avoid-duplicate-default-namespaces/84870" class="external-link">adding
new nodes will duplicate the namespace with a different identifier</a>,
so one way we have avoided this in {tinkr} (the package that does the
basic conversion) is to define a namespace with a prefix in a function
so that we can use it when querying:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tinkr</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/tinkr/reference/md_ns.html" class="external-link">md_ns</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; md &lt;-&gt; http://commonmark.org/xml/1.0</span></span>
<span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_all</a></span><span class="op">(</span><span class="va">xml</span>, <span class="st">".//md:paragraph"</span>, ns <span class="op">=</span> <span class="fu">tinkr</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/tinkr/reference/md_ns.html" class="external-link">md_ns</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_nodeset (4)}</span></span>
<span><span class="co">#&gt; [1] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;This is a bunch of &lt;/text&gt;\n  &lt; ...</span></span>
<span><span class="co">#&gt; [2] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;this&lt;/text&gt;\n&lt;/paragraph&gt;</span></span>
<span><span class="co">#&gt; [3] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;is&lt;/text&gt;\n&lt;/paragraph&gt;</span></span>
<span><span class="co">#&gt; [4] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;a &lt;/text&gt;\n  &lt;strong&gt;\n    &lt;tex ...</span></span></code></pre></div>
<p>It’s also important to remember that <em>all nodes</em> will require
this namespace prefix, so if we wanted to only select paragraphs that
were inside of a list, we would need to specify use
<code>.//md:list//md:paragraph</code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html" class="external-link">xml_find_all</a></span><span class="op">(</span><span class="va">xml</span>, <span class="st">".//md:list//md:paragraph"</span>, ns <span class="op">=</span> <span class="fu">tinkr</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/tinkr/reference/md_ns.html" class="external-link">md_ns</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_nodeset (3)}</span></span>
<span><span class="co">#&gt; [1] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;this&lt;/text&gt;\n&lt;/paragraph&gt;</span></span>
<span><span class="co">#&gt; [2] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;is&lt;/text&gt;\n&lt;/paragraph&gt;</span></span>
<span><span class="co">#&gt; [3] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;a &lt;/text&gt;\n  &lt;strong&gt;\n    &lt;tex ...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pegboard-namespace">Pegboard namespace<a class="anchor" aria-label="anchor" href="#pegboard-namespace"></a>
</h3>
<p>One of the reasons why we created pegboard was to handle markdown
content that also included <a href="https://pandoc.org/MANUAL.html#divs-and-spans" class="external-link">fenced divs</a>,
but we needed a way to programmatically label and extract them without
affecting the stylesheet that is used to translate the XML back to
Markdown (not covered in this tutorial). To acheive this we place nodes
under a different namespace around the fences and define our own
namespace.</p>
<p>Here’s an example:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>This is markdown with fenced divs</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>::: discussion</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>This is a discussion</span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a>:::</span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a>::: spoiler</span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a>This is a spoiler that is hidden by default</span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a>:::</span></code></pre></div>
<p>When it’s parsed by commonmark, the fenced divs are treated as
paragraphs:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">md</span> <span class="op">&lt;-</span> <span class="st">'This is markdown with fenced divs</span></span>
<span><span class="st"></span></span>
<span><span class="st">::: discussion</span></span>
<span><span class="st"></span></span>
<span><span class="st">This is a discussion</span></span>
<span><span class="st"></span></span>
<span><span class="st">:::</span></span>
<span><span class="st"></span></span>
<span><span class="st">::: spoiler</span></span>
<span><span class="st"></span></span>
<span><span class="st">This is a spoiler that is hidden by default</span></span>
<span><span class="st"></span></span>
<span><span class="st">:::</span></span>
<span><span class="st">'</span></span>
<span><span class="va">fences</span> <span class="op">&lt;-</span> <span class="fu">xml2</span><span class="fu">::</span><span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html" class="external-link">read_xml</a></span><span class="op">(</span><span class="fu">commonmark</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/commonmark/reference/commonmark.html" class="external-link">markdown_xml</a></span><span class="op">(</span><span class="va">md</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fences</span></span>
<span><span class="co">#&gt; {xml_document}</span></span>
<span><span class="co">#&gt; &lt;document xmlns="http://commonmark.org/xml/1.0"&gt;</span></span>
<span><span class="co">#&gt; [1] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;This is markdown with fenced di ...</span></span>
<span><span class="co">#&gt; [2] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;::: discussion&lt;/text&gt;\n&lt;/paragr ...</span></span>
<span><span class="co">#&gt; [3] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;This is a discussion&lt;/text&gt;\n&lt;/ ...</span></span>
<span><span class="co">#&gt; [4] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;:::&lt;/text&gt;\n&lt;/paragraph&gt;</span></span>
<span><span class="co">#&gt; [5] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;::: spoiler&lt;/text&gt;\n&lt;/paragraph&gt;</span></span>
<span><span class="co">#&gt; [6] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;This is a spoiler that is hidde ...</span></span>
<span><span class="co">#&gt; [7] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;:::&lt;/text&gt;\n&lt;/paragraph&gt;</span></span></code></pre></div>
<p>In {pegboard}, we have an internal function called
<code><a href="../reference/div_labels.html">label_div_tags()</a></code> that will allow us to label and parse
these tags without affecting the markdown document:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ns-internal.html" class="external-link">asNamespace</a></span><span class="op">(</span><span class="st">"pegboard"</span><span class="op">)</span></span>
<span><span class="va">pb</span><span class="op">$</span><span class="fu">label_div_tags</span><span class="op">(</span><span class="va">fences</span><span class="op">)</span></span>
<span><span class="va">fences</span></span>
<span><span class="co">#&gt; {xml_document}</span></span>
<span><span class="co">#&gt; &lt;document xmlns="http://commonmark.org/xml/1.0"&gt;</span></span>
<span><span class="co">#&gt;  [1] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;This is markdown with fenced d ...</span></span>
<span><span class="co">#&gt;  [2] &lt;dtag xmlns="http://carpentries.org/pegboard/" label="div-1-discussion"/&gt;</span></span>
<span><span class="co">#&gt;  [3] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;::: discussion&lt;/text&gt;\n&lt;/parag ...</span></span>
<span><span class="co">#&gt;  [4] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;This is a discussion&lt;/text&gt;\n&lt; ...</span></span>
<span><span class="co">#&gt;  [5] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;:::&lt;/text&gt;\n&lt;/paragraph&gt;</span></span>
<span><span class="co">#&gt;  [6] &lt;dtag xmlns="http://carpentries.org/pegboard/" label="div-1-discussion"/&gt;</span></span>
<span><span class="co">#&gt;  [7] &lt;dtag xmlns="http://carpentries.org/pegboard/" label="div-2-spoiler"/&gt;</span></span>
<span><span class="co">#&gt;  [8] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;::: spoiler&lt;/text&gt;\n&lt;/paragraph&gt;</span></span>
<span><span class="co">#&gt;  [9] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;This is a spoiler that is hidd ...</span></span>
<span><span class="co">#&gt; [10] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;:::&lt;/text&gt;\n&lt;/paragraph&gt;</span></span>
<span><span class="co">#&gt; [11] &lt;dtag xmlns="http://carpentries.org/pegboard/" label="div-2-spoiler"/&gt;</span></span></code></pre></div>
<p>Note that we have defined a <code>&lt;dtag&gt;</code> XML node that
is defined under the pegboard namespace. These sandwich the nodes that
we want to query and allow us to use <code><a href="https://docs.ropensci.org/tinkr/reference/find_between.html" class="external-link">tinkr::find_between()</a></code>
to search for specific tags:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ns</span> <span class="op">&lt;-</span> <span class="va">pb</span><span class="op">$</span><span class="fu">get_ns</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ns</span> <span class="co"># both md and pegboard namespaces</span></span>
<span><span class="co">#&gt; md &lt;-&gt; http://commonmark.org/xml/1.0</span></span>
<span><span class="co">#&gt; pb &lt;-&gt; http://carpentries.org/pegboard/</span></span>
<span><span class="fu">tinkr</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/tinkr/reference/find_between.html" class="external-link">find_between</a></span><span class="op">(</span><span class="va">fences</span>, ns <span class="op">=</span> <span class="va">ns</span>, pattern <span class="op">=</span> <span class="st">"pb:dtag[@label='div-1-discussion']"</span><span class="op">)</span></span>
<span><span class="co">#&gt; {xml_nodeset (3)}</span></span>
<span><span class="co">#&gt; [1] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;::: discussion&lt;/text&gt;\n&lt;/paragr ...</span></span>
<span><span class="co">#&gt; [2] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;This is a discussion&lt;/text&gt;\n&lt;/ ...</span></span>
<span><span class="co">#&gt; [3] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;:::&lt;/text&gt;\n&lt;/paragraph&gt;</span></span></code></pre></div>
<p>This is automated in the <code><a href="../reference/get_divs.html">get_divs()</a></code> internal
function:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pb</span><span class="op">$</span><span class="fu">get_divs</span><span class="op">(</span><span class="va">fences</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`div-1-discussion`</span></span>
<span><span class="co">#&gt; {xml_nodeset (3)}</span></span>
<span><span class="co">#&gt; [1] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;::: discussion&lt;/text&gt;\n&lt;/paragr ...</span></span>
<span><span class="co">#&gt; [2] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;This is a discussion&lt;/text&gt;\n&lt;/ ...</span></span>
<span><span class="co">#&gt; [3] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;:::&lt;/text&gt;\n&lt;/paragraph&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`div-2-spoiler`</span></span>
<span><span class="co">#&gt; {xml_nodeset (3)}</span></span>
<span><span class="co">#&gt; [1] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;::: spoiler&lt;/text&gt;\n&lt;/paragraph&gt;</span></span>
<span><span class="co">#&gt; [2] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;This is a spoiler that is hidde ...</span></span>
<span><span class="co">#&gt; [3] &lt;paragraph&gt;\n  &lt;text xml:space="preserve"&gt;:::&lt;/text&gt;\n&lt;/paragraph&gt;</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>This is but a short introduction to using XML with {pegboard}. You
now have the basics of what the structure of XML is, how to use XPath
(with further resources), how to use XPath with namespaces, and how we
use namespaces in {pegboard} to allow us to parse specific items. It is
a good idea to practices working with XPath because it is useful not
only for working with XML representations of markdown documents, but it
is also heavily used for post-processing of HTML in both {pkgdown} and
the {sandpaper} packages.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Davey, Erin Becker, Zhian N. Kamvar.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
